<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ±</title>
  <style>
    :root {
      --primary: #3498db;
      --secondary: #2c3e50;
      --success: #27ae60;
      --warning: #f39c12;
      --danger: #e74c3c;
      --light: #f8f9fa;
      --dark: #343a40;
      --gray: #6c757d;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: "Cairo", "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f4f6f9;
      margin: 0;
      padding: 20px;
      line-height: 1.6;
      color: #333;
    }
    
    h1, h2, h3 {
      color: var(--secondary);
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }
    
    .summary {
      background: white;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    
    .sections-container {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .section-card {
      background: white;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    
    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding: 15px;
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      color: white;
      border-radius: 10px;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 10px;
    }
    
    th, td {
      padding: 12px;
      text-align: center;
      border-bottom: 1px solid #eee;
    }
    
    th {
      background-color: var(--light);
      color: var(--dark);
      font-weight: bold;
    }
    
    tr:hover {
      background-color: #f8f9fa;
    }
    
    button {
      padding: 8px 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin: 2px;
      font-size: 12px;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }
    
    .btn-edit {
      background-color: var(--primary);
      color: white;
    }
    
    .btn-edit:hover {
      background-color: #2980b9;
    }
    
    .btn-delete {
      background-color: var(--danger);
      color: white;
    }
    
    .btn-delete:hover {
      background-color: #c0392b;
    }
    
    .btn-income {
      background-color: var(--success);
      color: white;
    }
    
    .btn-income:hover {
      background-color: #219653;
    }
    
    .btn-view {
      background-color: var(--gray);
      color: white;
    }
    
    .btn-view:hover {
      background-color: #5a6268;
    }
    
    .btn-notes {
      background-color: var(--warning);
      color: white;
    }
    
    .btn-notes:hover {
      background-color: #e67e22;
    }
    
    .card {
      background: white;
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
      margin-top: 20px;
    }
    
    input, select, textarea {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      border: 1px solid #ddd;
      border-radius: 8px;
      box-sizing: border-box;
      font-size: 14px;
      font-family: inherit;
    }
    
    input:focus, select:focus, textarea:focus {
      border-color: var(--primary);
      outline: none;
      box-shadow: 0 0 5px rgba(52, 152, 219, 0.3);
    }
    
    textarea {
      height: 80px;
      resize: vertical;
    }
    
    .save-btn {
      background-color: var(--success);
      color: white;
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      border: none;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
    }
    
    .save-btn:hover {
      background-color: #219653;
    }
    
    .logout {
      color: var(--danger);
      text-decoration: none;
      font-weight: bold;
      display: inline-block;
      margin-bottom: 20px;
      padding: 10px 15px;
      border: 1px solid var(--danger);
      border-radius: 8px;
      transition: all 0.3s ease;
    }
    
    .logout:hover {
      background-color: var(--danger);
      color: white;
    }
    
    .income-form {
      background: var(--light);
      padding: 20px;
      border-radius: 10px;
      margin: 15px 0;
      border: 1px solid #e9ecef;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: var(--dark);
    }
    
    .loading {
      text-align: center;
      padding: 40px;
      color: var(--gray);
      font-size: 18px;
    }
    
    .error {
      color: var(--danger);
      text-align: center;
      padding: 20px;
      background: #f8d7da;
      border: 1px solid #f5c6cb;
      border-radius: 8px;
      margin: 10px 0;
    }
    
    .current-income {
      background: #e7f3ff;
      padding: 15px;
      border-radius: 8px;
      margin: 15px 0;
      border-right: 4px solid var(--primary);
    }
    
    .income-warning {
      background: #fff3cd;
      padding: 15px;
      border-radius: 8px;
      margin: 15px 0;
      border-right: 4px solid var(--warning);
      color: #856404;
    }
    
    .stats-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .stat-card {
      background: white;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      transition: transform 0.3s ease;
    }
    
    .stat-card:hover {
      transform: translateY(-5px);
    }
    
    .stat-value {
      font-size: 24px;
      font-weight: bold;
      color: var(--primary);
      margin: 10px 0;
    }
    
    .stat-label {
      color: var(--gray);
      font-size: 14px;
    }
    
    .progress-bar {
      width: 100%;
      height: 8px;
      background: #e9ecef;
      border-radius: 4px;
      overflow: hidden;
      margin: 10px 0;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--success), #20c997);
      transition: width 0.3s ease;
    }
    
    .target-achieved {
      color: var(--success);
      font-weight: bold;
    }
    
    .target-pending {
      color: var(--danger);
    }
    
    .section-total {
      font-size: 18px;
      font-weight: bold;
      background: var(--success);
      color: white;
      padding: 8px 15px;
      border-radius: 20px;
    }
    
    /* ØªØµÙ…ÙŠÙ… Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø­Ø³Ù† */
    .notes-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      padding: 20px;
    }
    
    .notes-container {
      background: white;
      border-radius: 15px;
      width: 100%;
      max-width: 800px;
      max-height: 90vh;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }
    
    .notes-header {
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      color: white;
      padding: 25px;
      text-align: center;
    }
    
    .notes-header h2 {
      margin: 0;
      font-size: 1.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    .employee-info {
      background: var(--light);
      padding: 20px;
      border-bottom: 1px solid #eee;
    }
    
    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 15px;
    }
    
    .info-item {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid #f0f0f0;
    }
    
    .info-label {
      font-weight: bold;
      color: var(--dark);
    }
    
    .info-value {
      color: var(--secondary);
    }
    
    .notes-content {
      padding: 25px;
      max-height: 50vh;
      overflow-y: auto;
    }
    
    .notes-list {
      border: 1px solid #e9ecef;
      border-radius: 10px;
      padding: 15px;
      background: #f9f9f9;
      margin-bottom: 25px;
      min-height: 200px;
      max-height: 300px;
      overflow-y: auto;
    }
    
    .note-item {
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 10px;
      background: white;
      border-left: 4px solid var(--primary);
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    
    .note-manager {
      border-left-color: var(--warning);
      background: linear-gradient(135deg, #fff9e6 0%, #fff 100%);
    }
    
    .note-employee {
      border-left-color: var(--primary);
      background: linear-gradient(135deg, #e7f3ff 0%, #fff 100%);
    }
    
    .note-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      padding-bottom: 8px;
      border-bottom: 1px dashed #eee;
    }
    
    .note-sender {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: bold;
      color: var(--dark);
    }
    
    .note-date {
      color: var(--gray);
      font-size: 0.85rem;
    }
    
    .note-content {
      color: var(--dark);
      line-height: 1.5;
    }
    
    .empty-notes {
      text-align: center;
      color: var(--gray);
      padding: 40px 20px;
      font-style: italic;
    }
    
    .error-message {
      background: #f8d7da;
      color: var(--danger);
      padding: 15px;
      border-radius: 8px;
      border: 1px solid #f5c6cb;
      margin-bottom: 20px;
      text-align: center;
    }
    
    .add-note-form {
      background: var(--light);
      padding: 20px;
      border-radius: 10px;
      border: 1px solid #e9ecef;
    }
    
    .form-actions {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    
    .form-actions .btn {
      flex: 1;
      padding: 12px;
    }
    
    .btn {
      padding: 12px 25px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .btn-primary {
      background: var(--primary);
      color: white;
    }
    
    .btn-primary:hover {
      background: #2980b9;
    }
    
    .btn-secondary {
      background: var(--gray);
      color: white;
    }
    
    .btn-secondary:hover {
      background: #5a6268;
    }
    
    .loading-spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid var(--primary);
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* ØªØµÙ…ÙŠÙ… Ù…ØªØ¬Ø§ÙˆØ¨ Ù„Ù„Ø¬ÙˆØ§Ù„ */
    @media (max-width: 1200px) {
      .section-card {
        overflow-x: auto;
      }
      
      table {
        min-width: 1000px;
      }
    }
    
    @media (max-width: 768px) {
      body {
        padding: 10px;
      }
      
      .section-header {
        flex-direction: column;
        gap: 10px;
        text-align: center;
      }
      
      .stats-container {
        grid-template-columns: 1fr;
      }
      
      .card {
        padding: 15px;
      }
      
      .section-card {
        padding: 15px;
      }
      
      button {
        font-size: 11px;
        padding: 6px 10px;
      }
      
      .action-buttons {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 5px;
      }
      
      .action-buttons button {
        flex: 1;
        min-width: 80px;
      }
      
      .notes-modal {
        padding: 10px;
      }
      
      .notes-container {
        max-height: 95vh;
      }
      
      .notes-header {
        padding: 20px 15px;
      }
      
      .notes-header h2 {
        font-size: 1.3rem;
      }
      
      .employee-info {
        padding: 15px;
      }
      
      .info-grid {
        grid-template-columns: 1fr;
        gap: 10px;
      }
      
      .notes-content {
        padding: 20px 15px;
      }
      
      .note-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 5px;
      }
      
      .form-actions {
        flex-direction: column;
      }
    }
    
    @media (max-width: 576px) {
      h1 {
        font-size: 1.5rem;
      }
      
      h2 {
        font-size: 1.3rem;
      }
      
      .summary {
        padding: 15px;
      }
      
      .stat-card {
        padding: 15px;
      }
      
      .stat-value {
        font-size: 20px;
      }
    }
    
    /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ù„Ù„Ø¬ÙˆØ§Ù„ */
    .mobile-employee-card {
      display: none;
      background: white;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 15px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      border-right: 4px solid var(--primary);
    }
    
    .mobile-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      padding-bottom: 10px;
      border-bottom: 1px solid #eee;
    }
    
    .mobile-employee-name {
      font-weight: bold;
      color: var(--secondary);
    }
    
    .mobile-employee-id {
      color: var(--gray);
      font-size: 0.9rem;
    }
    
    .mobile-card-details {
      margin-bottom: 15px;
    }
    
    .mobile-detail-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      padding: 5px 0;
    }
    
    .mobile-detail-label {
      font-weight: bold;
      color: var(--dark);
    }
    
    .mobile-detail-value {
      color: var(--secondary);
    }
    
    .mobile-card-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }
    
    .mobile-card-actions button {
      flex: 1;
      min-width: 70px;
      justify-content: center;
    }
    
    @media (max-width: 768px) {
      table {
        display: none;
      }
      
      .mobile-employee-card {
        display: block;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <a href="login.html" class="logout">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</a>
    <h1>ğŸ‘¨â€ğŸ’¼ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ±</h1>

    <div class="summary">
      <h2>ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø±ÙƒØ²</h2>
      <div class="stats-container">
        <div class="stat-card">
          <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯Ø®Ù„</div>
          <div class="stat-value" id="total-income">0 Ø±ÙŠØ§Ù„</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</div>
          <div class="stat-value" id="total-employees">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</div>
          <div class="stat-value" id="total-sections">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Ù…ØªÙˆØ³Ø· ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„Ù‡Ø¯Ù</div>
          <div class="stat-value" id="avg-target">0%</div>
        </div>
      </div>
    </div>

    <div class="sections-container" id="sections">
      <div class="loading">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
    </div>

    <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ©/ØªØ­Ø¯ÙŠØ« Ø¯Ø®Ù„ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø¯ÙŠØ± -->
    <div class="card" id="income-card" style="display:none;">
      <h2 id="income-title">ğŸ’° Ø¥Ø¶Ø§ÙØ©/ØªØ­Ø¯ÙŠØ« Ø¯Ø®Ù„ Ù„Ù„Ù…ÙˆØ¸Ù</h2>
      <div class="income-form">
        <div class="form-group">
          <label>ğŸ‘¤ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ÙˆØ¸Ù</label>
          <select id="income-emp-select">
            <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ¸Ù --</option>
          </select>
        </div>
        
        <div id="current-income-info" class="current-income" style="display:none;">
          <strong>ğŸ’° Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ:</strong> 
          <span id="current-income-amount">0</span> Ø±ÙŠØ§Ù„
          <br>
          <small>ğŸ“… Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: <span id="current-income-date">-</span></small>
          <br>
          <small>ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø³Ø§Ø¨Ù‚Ø©: <span id="current-income-note">-</span></small>
        </div>

        <div id="income-warning" class="income-warning" style="display:none;">
          âš ï¸ <strong>ØªÙ†Ø¨ÙŠÙ‡:</strong> Ø³ÙŠØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ Ø¨Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¬Ø¯ÙŠØ¯
        </div>
        
        <div class="form-group">
          <label>ğŸ’µ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ø±ÙŠØ§Ù„)</label>
          <input type="number" id="income-amount" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¬Ø¯ÙŠØ¯" step="0.01" min="0">
        </div>
        <div class="form-group">
          <label>ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø¯ÙŠØ±</label>
          <textarea id="income-note" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø­ÙˆÙ„ Ø§Ù„Ø¯Ø®Ù„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"></textarea>
        </div>
        <div class="form-group">
          <label>ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ­Ø¯ÙŠØ«</label>
          <input type="text" id="income-date" readonly value="Ø³ÙŠØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹">
        </div>
        <button class="save-btn" onclick="addOrUpdateIncome()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¯Ø®Ù„</button>
        <button style="background: var(--gray); margin-top: 10px; width: 100%; padding: 10px;" onclick="closeIncomeForm()">âŒ Ø¥Ù„ØºØ§Ø¡</button>
      </div>
    </div>

    <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø­Ø³Ù† -->
    <div class="notes-modal" id="notes-modal">
      <div class="notes-container">
        <div class="notes-header">
          <h2>ğŸ’¬ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù</h2>
        </div>
        
        <div class="employee-info">
          <div class="info-grid">
            <div class="info-item">
              <span class="info-label">ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…:</span>
              <span class="info-value" id="modal-emp-name">-</span>
            </div>
            <div class="info-item">
              <span class="info-label">ğŸ†” Ø§Ù„Ø±Ù‚Ù…:</span>
              <span class="info-value" id="modal-emp-id">-</span>
            </div>
            <div class="info-item">
              <span class="info-label">ğŸ¯ Ø§Ù„Ù‡Ø¯Ù:</span>
              <span class="info-value" id="modal-emp-target">-</span>
            </div>
            <div class="info-item">
              <span class="info-label">ğŸ’° Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ:</span>
              <span class="info-value" id="modal-emp-income">-</span>
            </div>
          </div>
        </div>
        
        <div class="notes-content">
          <h3 style="margin-bottom: 15px; color: var(--secondary); display: flex; align-items: center; gap: 8px;">
            ğŸ“ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
          </h3>
          
          <div class="notes-list" id="notes-list">
            <div class="loading">
              <div class="loading-spinner"></div>
              Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª...
            </div>
          </div>
          
          <div class="add-note-form">
            <div class="form-group">
              <label for="new-note">âœï¸ Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ø§Ø­Ø¸Ø© Ø¬Ø¯ÙŠØ¯Ø©:</label>
              <textarea 
                id="new-note" 
                placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸ØªÙƒ Ù‡Ù†Ø§... ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø­ÙˆÙ„ Ø§Ù„Ø£Ø¯Ø§Ø¡ØŒ Ø§Ù„ØªÙ‚Ø¯Ù…ØŒ Ø£Ùˆ Ø£ÙŠ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø£Ø®Ø±Ù‰ Ù…Ù‡Ù…Ø©."
              ></textarea>
            </div>
            
            <div class="form-actions">
              <button class="btn btn-primary" onclick="addNote()">
                â• Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ø§Ø­Ø¸Ø©
              </button>
              <button class="btn btn-secondary" onclick="closeNotesModal()">
                âŒ Ø¥ØºÙ„Ø§Ù‚
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="card">
      <h2>ğŸ‘¤ Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯</h2>
      <input id="emp-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù">
      <input id="emp-target" type="number" placeholder="Ø§Ù„Ù‡Ø¯Ù (Ø±ÙŠØ§Ù„)" step="0.01" min="0">
      <select id="emp-section">
        <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…</option>
        <option value="1">Ù…ÙƒØ§Ù†ÙŠÙƒØ§</option>
        <option value="2">ÙƒÙ‡Ø±Ø¨Ø§Ø¡</option>
        <option value="3">ÙƒØ´Ù</option>
        <option value="4">Ø§Ø¯Ø§Ø±Ø©</option>
      </select>
      <input id="emp-username" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
      <input id="emp-password" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
      <button class="save-btn" onclick="addEmployee()">â• Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù</button>
    </div>

    <div class="card" id="edit-card" style="display:none;">
      <h2>âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù</h2>
      <input id="edit-id" type="hidden">
      <input id="edit-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù">
      <input id="edit-target" type="number" placeholder="Ø§Ù„Ù‡Ø¯Ù (Ø±ÙŠØ§Ù„)" step="0.01" min="0">
      <input id="edit-username" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
      <input id="edit-password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
      <button class="save-btn" onclick="saveEdit()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„</button>
      <button style="background: var(--gray); margin-top: 10px; width: 100%; padding: 10px;" onclick="closeEditForm()">âŒ Ø¥Ù„ØºØ§Ø¡</button>
    </div>
  </div>

  <script>
    let currentEmployeeForIncome = null;
    let currentEmployeeData = {};
    let currentEmployeeForNotes = null;

    // Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ù…ÙˆØ°Ø¬ÙŠØ© Ù„Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø³ØªØ£ØªÙŠ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª)
    const sampleNotes = [
      {
        id: 1,
        content: "Ø£Ø¯Ø§Ø¡ Ø¬ÙŠØ¯ Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ØŒ Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„Ø¹Ù…Ù„ Ø¨Ù†ÙØ³ Ø§Ù„ÙˆØªÙŠØ±Ø©",
        type: "manager",
        sender: "Ø§Ù„Ù…Ø¯ÙŠØ±",
        date: "2023-12-01"
      },
      {
        id: 2,
        content: "Ø´ÙƒØ±Ø§Ù‹ØŒ Ø³Ø£Ø¹Ù…Ù„ Ø¹Ù„Ù‰ ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ù…Ø·Ù„ÙˆØ¨",
        type: "employee",
        sender: "ÙˆØ³Ù†",
        date: "2023-12-02"
      },
      {
        id: 3,
        content: "ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ø¬Ø¯Ø¯ Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¯Ø®Ù„",
        type: "manager",
        sender: "Ø§Ù„Ù…Ø¯ÙŠØ±",
        date: "2023-12-03"
      }
    ];

    // Ø¯Ø§Ù„Ø© Ù„Ù…Ù„Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
    async function populateEmployeeSelect() {
        try {
            const response = await fetch("/api/employees");
            if (!response.ok) throw new Error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†');
            
            const employees = await response.json();
            const select = document.getElementById("income-emp-select");
            
            select.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…ÙˆØ¸Ù --</option>';
            
            employees.forEach(emp => {
                const option = document.createElement("option");
                option.value = emp.id;
                option.textContent = `${emp.name} - ${emp.section_name || 'Ø¨Ø¯ÙˆÙ† Ù‚Ø³Ù…'} (Ø¯Ø®Ù„ Ø­Ø§Ù„ÙŠ: ${(emp.total_income || 0).toLocaleString()} Ø±ÙŠØ§Ù„)`;
                select.appendChild(option);
            });
            
        } catch (error) {
            console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†:', error);
        }
    }

    // Ø¯Ø§Ù„Ø© ÙØªØ­ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¯Ø®Ù„
    async function openIncomeForm(empId, empName) {
        currentEmployeeForIncome = empId;
        
        // ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ
        const now = new Date();
        const today = now.toLocaleDateString('en-GB');
        document.getElementById("income-date").value = today;
        
        // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆØ¸Ù ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
        if (empId) {
            const select = document.getElementById("income-emp-select");
            for (let i = 0; i < select.options.length; i++) {
                if (select.options[i].value == empId) {
                    select.selectedIndex = i;
                    break;
                }
            }
        }
        
        // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        await loadCurrentEmployeeData(empId);
        
        document.getElementById("income-card").style.display = "block";
        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    }

    // Ø¯Ø§Ù„Ø© Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ø­Ø§Ù„ÙŠØ©
    async function loadCurrentEmployeeData(empId) {
        try {
            const response = await fetch(`/api/employees/${empId}`);
            if (!response.ok) throw new Error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù');
            
            const empData = await response.json();
            currentEmployeeData = empData;
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ
            const currentIncomeDiv = document.getElementById("current-income-info");
            const currentAmountSpan = document.getElementById("current-income-amount");
            const currentDateSpan = document.getElementById("current-income-date");
            const currentNoteSpan = document.getElementById("current-income-note");
            const warningDiv = document.getElementById("income-warning");
            
            if (empData.entry) {
                currentAmountSpan.textContent = (empData.entry.amount || 0).toLocaleString();
                currentDateSpan.textContent = new Date(empData.entry.updated_at).toLocaleDateString('en-GB');
                currentNoteSpan.textContent = empData.entry.note || 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª';
                currentIncomeDiv.style.display = 'block';
                warningDiv.style.display = 'block';
                
                // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                document.getElementById("income-amount").value = empData.entry.amount || '';
                document.getElementById("income-note").value = empData.entry.note || '';
                
                document.getElementById("income-title").textContent = "ğŸ’° ØªØ­Ø¯ÙŠØ« Ø¯Ø®Ù„ Ø§Ù„Ù…ÙˆØ¸Ù";
            } else {
                currentIncomeDiv.style.display = 'none';
                warningDiv.style.display = 'none';
                document.getElementById("income-amount").value = '';
                document.getElementById("income-note").value = '';
                document.getElementById("income-title").textContent = "ğŸ’° Ø¥Ø¶Ø§ÙØ© Ø¯Ø®Ù„ Ù„Ù„Ù…ÙˆØ¸Ù";
            }
            
        } catch (error) {
            console.error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù:', error);
        }
    }

    // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…ÙˆØ¸Ù
    document.getElementById("income-emp-select").addEventListener("change", async function() {
        const empId = this.value;
        if (empId) {
            await loadCurrentEmployeeData(empId);
        } else {
            document.getElementById("current-income-info").style.display = 'none';
            document.getElementById("income-warning").style.display = 'none';
            document.getElementById("income-amount").value = '';
            document.getElementById("income-note").value = '';
        }
    });

    function closeIncomeForm() {
        document.getElementById("income-card").style.display = "none";
        currentEmployeeForIncome = null;
        currentEmployeeData = {};
    }

    // Ø¯Ø§Ù„Ø© Ø¥Ø¶Ø§ÙØ©/ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¯Ø®Ù„
    async function addOrUpdateIncome() {
        const select = document.getElementById("income-emp-select");
        const empId = select.value;
        
        if (!empId) {
            alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…ÙˆØ¸Ù Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©");
            return;
        }
        
        const amount = parseFloat(document.getElementById("income-amount").value);
        const note = document.getElementById("income-note").value.trim();

        if (!amount || amount <= 0) {
            alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­ Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„ØµÙØ±");
            return;
        }

        // ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø¯Ø®Ù„ Ø­Ø§Ù„ÙŠ
        if (currentEmployeeData.entry) {
            const currentAmount = currentEmployeeData.entry.amount || 0;
            if (!confirm(`Ø³ÙŠØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ (${currentAmount.toLocaleString()} Ø±ÙŠØ§Ù„) Ø¨Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¬Ø¯ÙŠØ¯ (${amount.toLocaleString()} Ø±ÙŠØ§Ù„). Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ`)) {
                return;
            }
        }

        try {
            const response = await fetch(`/api/employees/${empId}/income`, {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({ 
                    amount, 
                    note
                })
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.message || 'Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¯Ø®Ù„');
            }

            const result = await response.json();
            closeIncomeForm();
            fetchSections();
            alert(result.message || "ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¯Ø®Ù„ Ø¨Ù†Ø¬Ø§Ø­");
        } catch (error) {
            alert("Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¯Ø®Ù„: " + error.message);
        }
    }

    // Ø¯Ø§Ù„Ø© ÙØªØ­ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø­Ø³Ù†
    async function openNotesForm(empId, empName, empTarget, empIncome) {
        currentEmployeeForNotes = empId;
        
        // ØªØ¹Ø¨Ø¦Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù ÙÙŠ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        document.getElementById("modal-emp-name").textContent = empName;
        document.getElementById("modal-emp-id").textContent = empId;
        document.getElementById("modal-emp-target").textContent = empTarget.toLocaleString() + " Ø±ÙŠØ§Ù„";
        document.getElementById("modal-emp-income").textContent = empIncome.toLocaleString() + " Ø±ÙŠØ§Ù„";
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        document.getElementById("notes-modal").style.display = "flex";
        
        // Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        await loadEmployeeNotes(empId);
    }

    // Ø¯Ø§Ù„Ø© Ø¬Ù„Ø¨ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù
    async function loadEmployeeNotes(empId) {
        try {
            // Ù…Ø­Ø§ÙƒØ§Ø© Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…
            setTimeout(() => {
                const notesList = document.getElementById("notes-list");
                
                if (sampleNotes && sampleNotes.length > 0) {
                    displayNotes(sampleNotes);
                } else {
                    notesList.innerHTML = '<div class="empty-notes">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</div>';
                }
            }, 1000);
            
        } catch (error) {
            console.error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª:', error);
            document.getElementById("notes-list").innerHTML = '<div class="error-message">âš ï¸ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</div>';
        }
    }

    // Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
    function displayNotes(notes) {
        const notesList = document.getElementById("notes-list");
        
        if (!notes || notes.length === 0) {
            notesList.innerHTML = '<div class="empty-notes">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</div>';
            return;
        }
        
        notesList.innerHTML = '';
        
        notes.forEach(note => {
            const noteElement = document.createElement('div');
            noteElement.className = `note-item ${note.type === 'manager' ? 'note-manager' : 'note-employee'}`;
            
            noteElement.innerHTML = `
                <div class="note-header">
                    <div class="note-sender">
                        ${note.type === 'manager' ? 'ğŸ‘¨â€ğŸ’¼' : 'ğŸ‘¤'} 
                        ${note.sender}
                    </div>
                    <div class="note-date">${formatDate(note.date)}</div>
                </div>
                <div class="note-content">${note.content}</div>
            `;
            
            notesList.appendChild(noteElement);
        });
        
        // Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¥Ù„Ù‰ Ø£Ø­Ø¯Ø« Ù…Ù„Ø§Ø­Ø¸Ø©
        notesList.scrollTop = notesList.scrollHeight;
    }

    // Ø¯Ø§Ù„Ø© Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ø§Ø­Ø¸Ø© Ø¬Ø¯ÙŠØ¯Ø©
    async function addNote() {
        const noteInput = document.getElementById('new-note');
        const content = noteInput.value.trim();
        
        if (!content) {
            alert('ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ù…Ù„Ø§Ø­Ø¸Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„');
            return;
        }
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ø§Ø­Ø¸Ø© Ø¬Ø¯ÙŠØ¯Ø©
        const newNote = {
            id: Date.now(),
            content: content,
            type: 'manager',
            sender: 'Ø§Ù„Ù…Ø¯ÙŠØ±',
            date: new Date().toISOString().split('T')[0]
        };
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
        sampleNotes.push(newNote);
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
        displayNotes(sampleNotes);
        
        // Ù…Ø³Ø­ Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
        noteInput.value = '';
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
        showSuccessMessage('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© Ø¨Ù†Ø¬Ø§Ø­');
    }

    // Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­
    function showSuccessMessage(message) {
        // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­ Ù…Ø¤Ù‚Øª
        const successMsg = document.createElement('div');
        successMsg.className = 'error-message';
        successMsg.style.background = '#d4edda';
        successMsg.style.borderColor = '#c3e6cb';
        successMsg.style.color = '#155724';
        successMsg.innerHTML = `<strong>âœ… Ù†Ø¬Ø§Ø­:</strong> ${message}`;
        
        const form = document.querySelector('.add-note-form');
        form.parentNode.insertBefore(successMsg, form);
        
        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†
        setTimeout(() => {
            successMsg.remove();
        }, 3000);
    }

    // Ø¯Ø§Ù„Ø© Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ®
    function formatDate(dateString) {
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        const date = new Date(dateString);
        return date.toLocaleDateString('ar-EG', options);
    }

    // Ø¯Ø§Ù„Ø© Ø¥ØºÙ„Ø§Ù‚ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
    function closeNotesModal() {
        document.getElementById("notes-modal").style.display = "none";
        currentEmployeeForNotes = null;
    }

    // Ø¯Ø§Ù„Ø© Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    async function fetchSections() {
        try {
            const secRes = await fetch("/api/sections-summary");
            if (!secRes.ok) throw new Error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ù‚Ø³Ø§Ù…');
            const secData = await secRes.json();
            
            const empRes = await fetch("/api/employees");
            if (!empRes.ok) throw new Error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†');
            const employees = await empRes.json();

            const container = document.getElementById("sections");
            container.innerHTML = "";
            let centerTotal = 0;
            let totalEmployees = 0;
            let totalTarget = 0;
            let achievedTarget = 0;

            if (secData.sections.length === 0) {
                container.innerHTML = '<div class="loading">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù‚Ø³Ø§Ù…</div>';
                return;
            }

            secData.sections.forEach(sec => {
                const sectionEmployees = employees.filter(e => e.section_id === sec.id);
                const sectionTotal = sectionEmployees.reduce((sum, e) => sum + (parseFloat(e.total_income) || 0), 0);
                centerTotal += sectionTotal;
                totalEmployees += sectionEmployees.length;

                // Ø­Ø³Ø§Ø¨ Ù…ØªÙˆØ³Ø· ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„Ù‡Ø¯Ù
                sectionEmployees.forEach(emp => {
                    const target = parseFloat(emp.target) || 0;
                    const income = parseFloat(emp.total_income) || 0;
                    totalTarget += target;
                    achievedTarget += Math.min(income, target);
                });

                const secCard = document.createElement("div");
                secCard.className = "section-card";
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø©
                let tableHTML = `
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Ø§Ù„Ø§Ø³Ù…</th>
                                <th>Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ</th>
                                <th>Ø§Ù„Ù‡Ø¯Ù</th>
                                <th>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</th>
                                <th>Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«</th>
                                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ù„Ù„Ø¬ÙˆØ§Ù„
                let mobileCardsHTML = '';
                
                sectionEmployees.forEach(emp => {
                    const totalIncome = parseFloat(emp.total_income) || 0;
                    const target = parseFloat(emp.target) || 0;
                    const remaining = target - totalIncome;
                    const progressPercent = target > 0 ? Math.min((totalIncome / target) * 100, 100) : 0;
                    const remainingDisplay = remaining > 0 ? 
                        `<span class="target-pending">${remaining.toLocaleString()} Ø±ÙŠØ§Ù„</span>` : 
                        '<span class="target-achieved">ğŸ¯ ØªÙ… Ø§Ù„Ù‡Ø¯Ù</span>';
                    const lastUpdate = emp.last_income_date ? new Date(emp.last_income_date).toLocaleDateString('en-GB') : 'Ù„Ø§ ÙŠÙˆØ¬Ø¯';
                    
                    // ØµÙ Ø§Ù„Ø¬Ø¯ÙˆÙ„
                    tableHTML += `
                    <tr>
                        <td>${emp.id}</td>
                        <td><strong>${emp.name}</strong></td>
                        <td><strong>${totalIncome.toLocaleString()}</strong> Ø±ÙŠØ§Ù„</td>
                        <td>${target.toLocaleString()} Ø±ÙŠØ§Ù„</td>
                        <td>${remainingDisplay}</td>
                        <td><small>${lastUpdate}</small></td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn-income" onclick="openIncomeForm(${emp.id}, '${emp.name.replace(/'/g, "\\'")}')">ğŸ’µ Ø¯Ø®Ù„</button>
                                <button class="btn-notes" onclick="openNotesForm(${emp.id}, '${emp.name.replace(/'/g, "\\'")}', ${target}, ${totalIncome})">ğŸ’¬ Ù…Ù„Ø§Ø­Ø¸Ø§Øª</button>
                                <button class="btn-edit" onclick="openEdit(${emp.id}, '${emp.name.replace(/'/g, "\\'")}', ${target}, '${(emp.username || "").replace(/'/g, "\\'")}', '${(emp.password || "").replace(/'/g, "\\'")}')">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
                                <button class="btn-delete" onclick="deleteEmployee(${emp.id})">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                            </div>
                            ${target > 0 ? `
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progressPercent}%"></div>
                            </div>
                            ` : ''}
                        </td>
                    </tr>
                    `;
                    
                    // Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¬ÙˆØ§Ù„
                    mobileCardsHTML += `
                    <div class="mobile-employee-card">
                        <div class="mobile-card-header">
                            <div class="mobile-employee-name">${emp.name}</div>
                            <div class="mobile-employee-id">ID: ${emp.id}</div>
                        </div>
                        <div class="mobile-card-details">
                            <div class="mobile-detail-row">
                                <span class="mobile-detail-label">ğŸ’µ Ø§Ù„Ø¯Ø®Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ:</span>
                                <span class="mobile-detail-value">${totalIncome.toLocaleString()} Ø±ÙŠØ§Ù„</span>
                            </div>
                            <div class="mobile-detail-row">
                                <span class="mobile-detail-label">ğŸ¯ Ø§Ù„Ù‡Ø¯Ù:</span>
                                <span class="mobile-detail-value">${target.toLocaleString()} Ø±ÙŠØ§Ù„</span>
                            </div>
                            <div class="mobile-detail-row">
                                <span class="mobile-detail-label">â³ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ:</span>
                                <span class="mobile-detail-value">${remainingDisplay}</span>
                            </div>
                            <div class="mobile-detail-row">
                                <span class="mobile-detail-label">ğŸ“… Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«:</span>
                                <span class="mobile-detail-value">${lastUpdate}</span>
                            </div>
                            ${target > 0 ? `
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progressPercent}%"></div>
                            </div>
                            ` : ''}
                        </div>
                        <div class="mobile-card-actions">
                            <button class="btn-income" onclick="openIncomeForm(${emp.id}, '${emp.name.replace(/'/g, "\\'")}')">ğŸ’µ Ø¯Ø®Ù„</button>
                            <button class="btn-notes" onclick="openNotesForm(${emp.id}, '${emp.name.replace(/'/g, "\\'")}', ${target}, ${totalIncome})">ğŸ’¬ Ù…Ù„Ø§Ø­Ø¸Ø§Øª</button>
                            <button class="btn-edit" onclick="openEdit(${emp.id}, '${emp.name.replace(/'/g, "\\'")}', ${target}, '${(emp.username || "").replace(/'/g, "\\'")}', '${(emp.password || "").replace(/'/g, "\\'")}')">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
                            <button class="btn-delete" onclick="deleteEmployee(${emp.id})">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                        </div>
                    </div>
                    `;
                });
                
                tableHTML += `</tbody></table>`;
                
                secCard.innerHTML = `
                    <div class="section-header">
                        <h3 style="margin: 0; color: white;">${sec.name}</h3>
                        <span class="section-total">${sectionTotal.toLocaleString()} Ø±ÙŠØ§Ù„</span>
                    </div>
                    ${tableHTML}
                    ${mobileCardsHTML}
                `;
                container.appendChild(secCard);
            });

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            document.getElementById("total-income").textContent = centerTotal.toLocaleString() + " Ø±ÙŠØ§Ù„";
            document.getElementById("total-employees").textContent = totalEmployees;
            document.getElementById("total-sections").textContent = secData.sections.length;
            
            // Ø­Ø³Ø§Ø¨ Ù…ØªÙˆØ³Ø· ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„Ù‡Ø¯Ù
            const avgTarget = totalTarget > 0 ? (achievedTarget / totalTarget) * 100 : 0;
            document.getElementById("avg-target").textContent = avgTarget.toFixed(1) + "%";

            await populateEmployeeSelect();

        } catch (error) {
            console.error('Error fetching sections:', error);
            document.getElementById("sections").innerHTML = '<div class="error">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ' + error.message + '</div>';
        }
    }

    // Ø¯Ø§Ù„Ø© Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯
    async function addEmployee() {
        const name = document.getElementById("emp-name").value.trim();
        const target = parseFloat(document.getElementById("emp-target").value);
        const section_id = document.getElementById("emp-section").value;
        const username = document.getElementById("emp-username").value.trim();
        const password = document.getElementById("emp-password").value.trim();
        
        if (!name || !target || target <= 0 || !section_id || !username || !password) {
            return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­");
        }

        try {
            const response = await fetch("/api/employees", {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({ name, target, section_id, username, password })
            });

            if (!response.ok) throw new Error('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¸Ù');

            // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø¶Ø§ÙØ©
            document.getElementById("emp-name").value = "";
            document.getElementById("emp-target").value = "";
            document.getElementById("emp-section").value = "";
            document.getElementById("emp-username").value = "";
            document.getElementById("emp-password").value = "";
            
            fetchSections();
            alert("âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¸Ù Ø¨Ù†Ø¬Ø§Ø­");
        } catch (error) {
            alert("âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¸Ù: " + error.message);
        }
    }

    function openEdit(id, name, target, username, password) {
        document.getElementById("edit-card").style.display = "block";
        document.getElementById("edit-id").value = id;
        document.getElementById("edit-name").value = name;
        document.getElementById("edit-target").value = target;
        document.getElementById("edit-username").value = username;
        document.getElementById("edit-password").value = password;
        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    }

    function closeEditForm() {
        document.getElementById("edit-card").style.display = "none";
    }

    async function saveEdit() {
        const id = document.getElementById("edit-id").value;
        const name = document.getElementById("edit-name").value.trim();
        const target = parseFloat(document.getElementById("edit-target").value);
        const username = document.getElementById("edit-username").value.trim();
        const password = document.getElementById("edit-password").value.trim();

        if (!name || !target || target <= 0 || !username || !password) {
            alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­");
            return;
        }

        try {
            const response = await fetch(`/api/employees/${id}`, {
                method: "PUT",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({ name, target, username, password })
            });

            if (!response.ok) throw new Error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');

            closeEditForm();
            fetchSections();
            alert("âœ… ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­");
        } catch (error) {
            alert("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«: " + error.message);
        }
    }

    async function deleteEmployee(id) {
        if (!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¸ÙØŸ Ø³ÙŠØªÙ… Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù…ÙˆØ¸Ù ÙˆÙ„ÙƒÙ† Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠØ©.")) return;
        
        try {
            const response = await fetch(`/api/employees/${id}`, { method: "DELETE" });
            if (!response.ok) throw new Error('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¸Ù');
            
            fetchSections();
            alert("âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¸Ù Ø¨Ù†Ø¬Ø§Ø­");
        } catch (error) {
            alert("âŒ Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¸Ù: " + error.message);
        }
    }

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
    document.addEventListener('DOMContentLoaded', function() {
        fetchSections();
    });
  </script>
</body>
</html>